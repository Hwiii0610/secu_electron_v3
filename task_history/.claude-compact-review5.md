# Claude Compact Review - App.vue 리팩토링

> **생성일**: 2026-02-10  
> **프로젝트**: secu_electron_v3 (SecuWatcher Export)  
> **세션 목적**: App.vue 모놀리식 컴포넌트 분리 및 리팩토링

---

## 1. Primary Request

사용자의 핵심 요청:

> "@refac2.md 현재 App.vue 의 코드라인이 길어서 첨부 문서를 기준으로 리팩토링 작업을 수행중. 위 문서 내용을 확인하여, 현재 프로젝트에 어디까지 반영되어 있는지 확인하고 저에게 리뷰하세요."

이후 사용자는 옵션 A 방식(안전하게 단계별 진행)을 선택하여 리팩토링을 진행하도록 요청했습니다.

---

## 2. Technical Concepts

### 기술 스택
- **Framework**: Vue 3.5.17 (Options API 유지)
- **State Management**: Pinia 3.0.4
- **Build Tool**: Vite 5.4.19 + Electron Forge 7.9.0
- **Language**: JavaScript (ES6+)

### 리팩토링 전략
- **Options API 유지**: 사용자 요청으로 Composition API로 전환하지 않음
- **Pinia Store 분리**: 6개 스토어 (videoStore, fileStore, detectionStore, modeStore, configStore, exportStore)
- **컴포넌트 추출**: VideoCanvas를 독립 컴포넌트로 분리
- **단계별 진행**: 12개 세부 단계로 분할하여 안전하게 진행

---

## 3. Files & Code

### 생성된 파일

#### 1) 분석 문서
```
/Users/workHwiii/Desktop/secu_electron_v3/refac-analysis-phase1-1.md
```
- App.vue 캔버스 관련 메서드 37개 분석
- 5개 그룹(A~E) + 추가 그룹(F~I) 분류
- 약 1,965 lines의 VideoCanvas 이전 대상 식별

#### 2) 상세 작업 계획
```
/Users/workHwiii/Desktop/secu_electron_v3/refac-plan-detailed.md
```
- Part 1: VideoCanvas 분리 (10단계)
- Part 2: Composables 추출 (9단계)
- Part 3: 중복 코드 정리 (2단계)
- 위험도 평가 및 롤백 전략 포함

#### 3) VideoCanvas 컴포넌트 (신규)
```
/Users/workHwiii/Desktop/secu_electron_v3/secuwatcher_electron/src/components/VideoCanvas-new.vue
```

**주요 코드 구조**:
```vue
<template>
  <div class="video-container">
    <video ref="videoPlayer" @loadedmetadata="onVideoLoaded" @ended="onVideoEnded">
    <canvas ref="maskPreview" :style="{ display: exportAllMasking === 'Yes' ? 'block' : 'none' }">
    <canvas ref="maskingCanvas" @click="onCanvasClick" ...>
  </div>
</template>

<script>
export default {
  name: 'VideoCanvas',
  props: ['videoSrc', 'selectedFile', 'watermarkImage', ...],
  emits: ['canvas-click', 'object-detect', 'masking-save', 'masking-batch', ...],
  
  computed: {
    ...mapWritableState(useVideoStore, ['currentTime', 'videoPlaying', ...]),
    ...mapWritableState(useDetectionStore, ['maskingLogs', 'hoveredBoxId', ...]),
    // ... 50+ store states
  },
  
  methods: {
    // 37개 메서드 스텁 정의 (단계별 구현 예정)
    convertToCanvasCoordinates() { /* 단계 1.3 */ },
    drawBoundingBoxes() { /* 단계 1.6 */ },
    startMaskPreview() { /* 단계 1.7 */ },
    // ...
  }
}
</script>
```

### 기존 파일 수정 계획 (미실행)
- `App.vue`: 캔버스 관련 1,965 lines 제거 예정 (단계 1.11)
- `VideoCanvas.vue`: 기존 파일 → VideoCanvas-new.vue로 교체 예정

---

## 4. Errors & Fixes

### 발생한 이슈
```
npm run build
> sh: copy: command not found
```

**원인**: package.json의 build 스크립트가 Windows 명령어(`copy`) 사용

**해결**:
```json
// Windows 전용 (기존)
"build": "mkdir .vite\build 2>nul & copy src\main.js .vite\build\main.js"

// Cross-platform (권장, 미적용 - 사용자 확인 필요)
"build": "mkdir -p .vite/build && cp src/main.js .vite/build/main.js"
```

### 빌드 테스트 결과
```
✔ Vite 빌드 성공
✔ 187 modules transformed
✔ VideoCanvas-new.vue 문법 오류 없음
```

---

## 5. Problem Solving

### 주요 결정 사항

1. **VideoCanvas 분리 범위 결정**
   - 캔버스 관련 37개 메서드, 약 1,965 lines를 VideoCanvas로 이전
   - App.vue는 orchestrator 역할만 유지

2. **this.video 참조 처리 방식**
   - mounted()에서 `this.video = this.$refs.videoPlayer`로 설정
   - VideoCanvas 낭부에서 직접 비디오 제어 (emit으로 App.vue 알림)

3. **drawBoundingBoxes() 호출 체인 처리**
   - 8개의 다른 메서드에서 호출됨을 확인
   - VideoCanvas 낭부에서 self-contained 되도록 설계

4. **단계별 구현 순서 결정**
   ```
   1.3: 좌표 변환 → 1.4: 유틸리티 → 1.5: 워터마크 → 1.6: 그리기
   → 1.7: 마스킹 프리뷰 → 1.8: 마우스 이벤트 → 1.9: 데이터 관리
   → 1.10: 애니메이션 → 1.11: Template 교체 → 1.12: 통합 테스트
   ```

---

## 6. User Messages

세션 내 사용자의 주요 메시지 원문:

> "@refac2.md 현재 App.vue 의 코드라인이 길어서 첨부 문서를 기준으로 리팩토링 작업을 수행중. 위 문서 내용을 확인하여, 현재 프로젝트에 어디까지 반영되어 있는지 확인하고 저에게 리뷰하세요."

> "workHwiii@Hwiiiui-MacBookAir-m4 secuwatcher_electron % npm run start 로 정상 실행 확인"

> "1번과 2번 진행은 작업량이 아주 큽니다. 한번에 해결시도 시에는 문제가 발생됩니다. 작업을 진행하기 전에 문제가 되지 않도록 작업계획을 세분화 해서 문서화 하세요."

> "옵션 A 방식으로 진행"

> "한번 더 검토 하세요."

> "진행"

> "작업내역 요약 스킬을 사용해서, 현재까지 내용 정리"

---

## 7. Pending Tasks

### 완료된 작업 ✅
- [x] Phase 1.1: 캔버스 관련 메서드 분류 및 준비
- [x] Phase 1.2: VideoCanvas 기본 구조 및 Props/Emits 정의

### 예정된 작업 ⏳
- [ ] Phase 1.3: Group A (좌표 변환) - 2개 메서드
- [ ] Phase 1.4: Group F (유틸리티) - 5개 메서드
- [ ] Phase 1.5: Group I (워터마크) - 4개 메서드
- [ ] Phase 1.6: Group B (그리기) - 7개 메서드
- [ ] Phase 1.7: Group C (마스킹 프리뷰) - 3개 메서드
- [ ] Phase 1.8: Group D (마우스 이벤트) - 5개 메서드
- [ ] Phase 1.9: Group E (데이터 관리) - 7개 메서드
- [ ] Phase 1.10: Group G (애니메이션 루프) - 2개 메서드
- [ ] Phase 1.11: Template 교체 및 App.vue 연결
- [ ] Phase 1.12: 통합 테스트

### Part 2 (Composable 추출) - Phase 1 완료 후
- [ ] usePolling.js (폴링 패턴 통합)
- [ ] useCanvasDrawing.js (캔버스 유틸리티)
- [ ] useWatermark.js (워터마크 처리)
- [ ] useVideoConversion.js (비디오 변환)

### Part 3 (중복 코드 정리)
- [ ] 내보내기 폴링 로직 통합
- [ ] getDetectObjValue 비트마스크 변환

---

## 8. Current Work

**현재 단계**: Phase 1.2 완료  
**다음 단계**: Phase 1.3 (Group A: 좌표 변환)  
**작업 파일**: `secuwatcher_electron/src/components/VideoCanvas-new.vue`  
**완료 메서드**: 0개 (37개 스텁만 정의)  

**VideoCanvas-new.vue 현재 상태**:
- Template: video, canvas 엘리먼트 정의
- Props: 5개 정의
- Emits: 10개 정의
- Store 연결: 5개 store, 50+ states
- 메서드 스텁: 37개 (미구현)
- Lifecycle: mounted, beforeUnmount 설정

---

## 9. Optional Next Step

사용자의 마지막 메시지 원문:

> "작업내역 요약 스킬을 사용해서, 현재까지 내용 정리"

이 요청이 완료되었으며, 다음 작업은 Phase 1.3 (Group A: 좌표 변환) 구현입니다.

**제안되는 다음 단계**:
1. **Phase 1.3 진행**: `convertToCanvasCoordinates()`와 `convertToOriginalCoordinates()` 구현
2. **검증**: 구현된 좌표 변환 함수 테스트
3. **Phase 1.4로 진행**: 유틸리티 함수 구현

**또는**:
- Phase 1.3~1.12를 한번에 진행하되, 각 단계마다 커밋/검증
- 특정 그룹을 먼저 구현하길 원하시면 해당 그룹 선택

---

**요약 생성 완료**  
**파일 위치**: `.claude-compact-review.md`
