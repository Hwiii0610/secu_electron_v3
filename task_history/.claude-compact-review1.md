# SecuWatcher Export - Mac 구동 환경 구축 작업 요약

## 완료된 작업

### 1. Git 저장소 초기화
- Git 저장소 초기화 및 첫 커밋 (102개 파일)
- `.gitignore` 설정 (Python/Node.js/Electron용)

### 2. Python 백엔드 환경 구축
- Python 3.14.2 가상환경 생성
- PyTorch 2.10.0 (Apple Silicon MPS 지원)
- MLX 0.30.6 (Apple Silicon 가속기)
- Ultralytics 8.3.121 (커스텀 버전)
- timm 1.0.24 (커스텀 Ultralytics 의존성)
- FastAPI, OpenCV, PyAV 등 주요 패키지 설치

### 3. Electron 프론트엔드 환경 구축
- Node.js v22.22.0
- npm 의존성 설치 (717 packages)
- Fuses 플러그인 충돌 해결 (개발 모드 비활성화)

### 4. macOS 호환성 수정
- **LEA-GCM 라이브러리**: macOS 호환 불가로 AES-GCM 폴리필 사용
- **MPS 백엔드**: Apple Silicon GPU 사용 설정 (`device = mps`)
- **FFmpeg**: 시스템 FFmpeg 사용 (`/opt/homebrew/bin/ffmpeg`)
- **경로 설정**: Windows 경로 → macOS 상대 경로로 변경

### 5. 라이선스/인증 비활성화
- 라이선스 검증 로직 주석 처리 (개발용)
- 첫 실행 감지 비활성화

### 6. 모델 설정
- 커스텀 Ultralytics 경로 설정
- RSA 키 쌍 생성 (key.pem, pubkey.pem)

### 7. CORS 문제 해결 (해결됨)
- **근본 원인**: FastAPI 앱이 두 번 생성되어 CORS 미들웨어가 첫 번째 앱에만 적용, 두 번째 앱(실제 사용)에는 누락
- **추가 원인**: `allow_origins=["*"]` + `allow_credentials=True` 조합은 CORS 스펙상 무효
- **해결**: 앱 단일 생성 + 명시적 origin 설정 (`localhost:5173`, `127.0.0.1:5173` 등)

### 8. /autoexport 엔드포인트 추가
- 프론트엔드 일괄처리 기능에서 호출하는 `/autoexport` 엔드포인트가 백엔드에 없었음
- 탐지 → 마스킹 → 워터마킹(옵션) 순차 처리하는 배치 엔드포인트 구현

### 9. macOS 경로 처리 수정
- `normalizeWinPath`: 포워드 슬래시/플랫폼별 분기 처리
- 디렉토리 추출 정규식: 양방향 슬래시 지원
- `local-video://` 프로토콜: macOS 절대 경로 호환

## 실행 방법

### 1. Python 백엔드
```bash
cd /Users/workHwiii/Desktop/secu_electron_v3/secuwatcher_python
source venv/bin/activate
python main.py
```

### 2. Electron 프론트엔드
```bash
cd /Users/workHwiii/Desktop/secu_electron_v3/secuwatcher_electron
npm run start
```

## 알려진 문제
1. **FFmpeg 라이브러리 충돌**: OpenCV와 PyAV의 FFmpeg 버전 차이로 경고 발생 (기능에 영향 없음)
2. **torchreid**: 설치 실패 (DeepSORT 일부 기능에 영향 가능)

## 수정된 주요 파일
- `secuwatcher_python/main.py` - CORS 설정, 모델 로드
- `secuwatcher_python/detector.py` - MPS 백엔드 지원
- `secuwatcher_python/lea_gcm_lib.py` - macOS AES-GCM 폴리필
- `secuwatcher_python/config.ini` - MPS 설정
- `secuwatcher_electron/src/main.js` - 라이선스 비활성화, FFmpeg 경로
- `secuwatcher_electron/src/App.vue` - 비디오 프로토콜 수정
- `secuwatcher_electron/forge.config.mjs` - Fuses 플러그인 설정
- `secuwatcher_electron/src/dirConfig.json` - macOS 경로 설정
